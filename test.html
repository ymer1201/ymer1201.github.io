<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python –≤ –±—Ä–∞—É–∑–µ—Ä–µ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        #code {
            width: 100%;
            height: 200px;
            padding: 10px;
            font-family: monospace;
        }
        button {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin: 10px 0;
        }
        button.stop {
            background: #f44336;
        }
        #output {
            background: #f0f0f0;
            padding: 10px;
            white-space: pre-wrap;
            min-height: 50px;
        }
    </style>
</head>
<body>
    <h1>–ó–∞–ø—É—Å—Ç–∏—Ç–µ Python-–∫–æ–¥ –≤ –±—Ä–∞—É–∑–µ—Ä–µ üêç</h1>
    <textarea id="code" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ Python...">
import time
for i in range(5):
    print(f"–®–∞–≥ {i}")
    time.sleep(1)
print("–ì–æ—Ç–æ–≤–æ!")
    </textarea>
    <br>
    <button onclick="runPython()">–í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–¥</button>
    <button onclick="stopPython()" class="stop">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–¥</button>
    <h3>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫:</h3>
    <input type="text" id="library" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏...">
    <button onclick="installLibrary()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É</button>
    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
    <div id="output"></div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Pyodide -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
    <script>
        let pyodide;
        let isRunning = false;
        let isPyodideReady = false;

        async function initializePyodide() {
            pyodide = await loadPyodide({
                indexURL: "https://cdn.jsdelivr.net/pyodide/v0.23.4/full/"
            });
            await pyodide.loadPackage("micropip");
            isPyodideReady = true;
            console.log("Pyodide –∑–∞–≥—Ä—É–∂–µ–Ω!");
        }

        async function runPython() {
            if (!isPyodideReady) {
                alert("Pyodide –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–æ–¥–æ–∂–¥–∏—Ç–µ...");
                return;
            }
            if (isRunning) {
                alert("–ö–æ–¥ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è!");
                return;
            }
            isRunning = true;
            const code = document.getElementById("code").value;
            const output = document.getElementById("output");
            output.innerText = "‚è≥ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ...";

            try {
                let capture = await pyodide.runPythonAsync(`
                    import sys
                    from pyodide.ffi import to_js

                    class PyodideLogger:
                        def __init__(self):
                            self.logs = []

                        def write(self, msg):
                            self.logs.append(msg)

                        def flush(self):
                            pass

                        def get_logs(self):
                            return to_js("".join(self.logs))

                    logger = PyodideLogger()
                    sys.stdout = sys.stderr = logger
                    logger
                `);

                await pyodide.runPythonAsync(code);

                const logs = await capture.get_logs();
                output.innerText = logs || "‚úÖ –ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω!";
            } catch (e) {
                output.innerText = `üö® –û—à–∏–±–∫–∞: ${e.message}`;
            } finally {
                isRunning = false;
            }
        }

        function stopPython() {
            if (!isRunning) {
                alert("–ù–µ—Ç –≤—ã–ø–æ–ª–Ω—è—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞!");
                return;
            }
            location.reload();
        }

        async function installLibrary() {
            if (!isPyodideReady) {
                alert("Pyodide –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–æ–¥–æ–∂–¥–∏—Ç–µ...");
                return;
            }
            const library = document.getElementById("library").value;
            if (!library) {
                alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏!");
                return;
            }
            const output = document.getElementById("output");
            output.innerText = `‚è≥ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É ${library}...`;

            try {
                await pyodide.runPythonAsync(`
                    import micropip
                    micropip.install("${library}")
                `);
                output.innerText = `‚úÖ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ ${library} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!`;
            } catch (e) {
                output.innerText = `üö® –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ ${library}:\n${e.message}`;
            }
        }

        initializePyodide();
    </script>
</body>
</html>